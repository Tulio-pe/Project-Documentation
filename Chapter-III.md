# Capítulo III: Requirements Specification

## 3.1. To-Be Scenario Mapping
>Segmento 1

<img src="./src/To-Be_segmento1.png " alt="To-Be_segmento1" style="display: block; margin: 50px auto 0 auto;"/> 

>Segmento 2

<img src="./src/To-be_segmento2.png " alt="To-be_segmento2" style="display: block; margin: 50px auto 0 auto;"/> 

## 3.2. User Stories
This section provides a collection of user stories that describe the functionalities and features from the end-user perspective.

## Épicas - Sistema de Gestión de Talleres

## E01 - Gestión de Cuentas y Autenticación
**Descripción:** Como gestor de taller, necesito un sistema completo de autenticación que me permita registrarme, iniciar sesión, mantener mi perfil actualizado y cerrar sesión de forma segura, para acceder de manera controlada a todas las funcionalidades de la plataforma.

**Objetivo:** Proporcionar un sistema seguro y confiable de gestión de cuentas de usuario para los gestores de taller.

**Criterios de Aceptación:**
- Sistema de registro con validación de datos únicos
- Actualización de perfil personal
- Cierre de sesión seguro con invalidación de tokens

---

## E02 - Gestión de Información del Taller
**Descripción:** Como gestor de taller, necesito poder registrar, mantener y actualizar toda la información básica de mi taller, incluyendo datos de contacto, ubicación y horarios de atención, para que los clientes puedan encontrarme y conocer mi disponibilidad.

**Objetivo:** Permitir a los gestores mantener actualizada la información completa de su taller en la plataforma.

**Criterios de Aceptación:**
- Registro completo de información del taller con validaciones
- Edición de datos del taller
- Configuración de horarios regulares por días de la semana
- Actualización de horarios de atención

---

## E03 - Búsqueda y Visualización de Talleres (Conductores)
**Descripción:** Como conductor, necesito poder buscar talleres cercanos utilizando filtros geográficos y ver información detallada de cada uno, incluyendo sus datos de contacto y horarios, para elegir el taller que mejor se adapte a mis necesidades y ubicación.

**Objetivo:** Facilitar a los conductores la búsqueda y selección de talleres mediante una interfaz intuitiva con filtros geográficos.

**Criterios de Aceptación:**
- Filtrado por ubicación 
- Listado de talleres con información resumida
- Vista detallada de cada taller con información completa
- Integración con WhatsApp para contacto directo

---

## E04 - Gestión de Vehículos
**Descripción:** Como gestor de taller, necesito registrar y mantener un catálogo de vehículos de mis clientes con sus datos técnicos, para poder asociarlos posteriormente a órdenes de reparación y llevar un control organizado del trabajo.

**Objetivo:** Proporcionar un sistema de gestión de vehículos que sirva como base para las órdenes de reparación.

**Criterios de Aceptación:**
- Registro de vehículos con validación de placas únicas
- Listado de vehículos registrados por taller
- Asociación directa con órdenes de reparación

---

## E05 - Gestión de Órdenes de Reparación
**Descripción:** Como gestor de taller, necesito crear y gestionar órdenes de reparación para cada vehículo, controlando su estado a través de un flujo definido (Por revisar → En revisión → Revisado → Entregado), para llevar un seguimiento ordenado del trabajo y proporcionar información actualizada a los clientes.

**Objetivo:** Implementar un sistema completo de gestión de órdenes de reparación con seguimiento de estados.

**Criterios de Aceptación:**
- Creación de órdenes con códigos únicos
- Gestión de estados con flujo controlado
- Filtrado de órdenes por estado
- Control de órdenes abiertas por vehículo

---

## E06 - Seguimiento de Reparaciones (Conductores)
**Descripción:** Como conductor, necesito poder consultar el estado actual de la reparación de mi vehículo utilizando un código de seguimiento, para estar informado del progreso sin necesidad de contactar directamente al taller.

**Objetivo:** Ofrecer transparencia y comunicación efectiva sobre el estado de las reparaciones a los conductores.

**Criterios de Aceptación:**
- Consulta por código de seguimiento
- Visualización completa del estado y detalles de la reparación
- Información del vehículo y taller
- Opción de contacto directo con el taller

## Historias de Usuario

| Epic/User Story ID | Título | Descripción | Criterios de Aceptación | Relacionado con (Epic ID) |
|--------------------|--------|-------------|-------------------------|---------------------------|
| US01 | Registrar cuenta de gestor | Como gestor de taller, quiero registrarme en la plataforma, para obtener una cuenta que me permita acceder a mis funciones. | **Scenario:** Registro exitoso de gestor<br>**Given** el gestor está en el formulario "Registro"<br>**When** completa email, firstname, lastname, username y password (≥ 6 caracteres)<br>**And** el email y el username no existen en la base de datos<br>**And** pulsa "Registrarse"<br>**Then** el sistema guarda la cuenta con la contraseña encriptada (bcrypt)<br>**And** redirige al inicio de sesión | E01 |
| US02 | Iniciar sesión | Como gestor de taller, quiero iniciar sesión con mis credenciales, para acceder a la plataforma. | **Scenario:** Inicio de sesión válido<br>**Given** el gestor está en la pantalla "Login"<br>**When** ingresa email y password correctos<br>**Then** el sistema emite un JWT<br>**And** redirige al dashboard u onboarding según corresponda<br><br>**Scenario:** Inicio de sesión inválido<br>**Given** el gestor está en la pantalla "Login"<br>**When** ingresa email o password incorrectos<br>**Then** el sistema muestra "Credenciales inválidas"<br>**And** permanece en la misma pantalla | E01 |
| US03 | Actualizar perfil personal | Como gestor de taller, quiero actualizar mis datos personales, para mantener mi información al día. | **Scenario:** Actualización exitosa del perfil<br>**Given** el gestor está autenticado y en "Mi perfil"<br>**When** modifica firstname, lastname o username (dejando email y password sin cambios)<br>**And** el nuevo username no existe en otro usuario<br>**And** pulsa "Guardar"<br>**Then** el sistema actualiza los datos en la base de datos<br>**And** muestra el mensaje "Datos actualizados" | E01 |
| US04 | Cerrar sesión | Como gestor de taller, quiero cerrar sesión, para finalizar mi acceso de forma segura. | **Scenario:** Cierre de sesión<br>**Given** el gestor está autenticado en la plataforma<br>**When** pulsa "Cerrar sesión"<br>**Then** el sistema invalida el JWT actual<br>**And** redirige al inicio de sesión<br>**And** muestra "Sesión cerrada" | E01 |
| US05 | Registrar información del taller | Como gestor de taller, quiero registrar la información básica de mi taller, para que aparezca en la plataforma y los clientes puedan encontrarlo. | **Scenario:** Registro exitoso del taller<br>**Given** el gestor está en el formulario "Registrar taller"<br>**When** completa photo (png/jpg), address, email, name, phone, description y selecciona ubicación Región → Provincia → Distrito → Ciudad<br>**And** el email tiene formato válido y todos los campos son obligatorios<br>**Then** el sistema guarda la ficha del taller en la BD<br>**And** muestra el mensaje "Taller registrado" | E02 |
| US06 | Editar información del taller | Como gestor de taller, quiero editar la información básica de mi taller cuando cambie, para mantener en la plataforma datos siempre correctos y actualizados. | **Scenario:** Actualización de datos del taller<br>**Given** el gestor abre la pantalla "Editar taller" y los campos se autocompletan<br>**When** modifica photo, address, description, email, name, phone o ubicación (cascada Región → Provincia → Distrito → Ciudad)<br>**And** pulsa "Guardar"<br>**Then** el sistema actualiza la información del taller en la BD<br>**And** muestra el mensaje "Taller actualizado" | E02 |
| US07 | Configurar horarios regulares | Como gestor de taller, quiero configurar los días y horarios regulares de atención de mi taller, para que los clientes sepan cuándo pueden agendar una cita. | **Scenario:** Definir horarios iniciales<br>**Given** el gestor está en la sección "Horarios"<br>**When** añade entradas para cada día de la semana con StartTime y EndTime válidos (StartTime < EndTime, ≤ 24 h)<br>**And** puede marcar un día como "No atiende" mediante Enabled = false<br>**Then** el sistema guarda la lista completa en la BD<br>**And** muestra confirmación de guardado | E02 |
| US08 | Actualizar horarios de atención | Como gestor de taller, quiero actualizar los días y horarios de atención cuando cambien, para mantener la información siempre al día. | **Scenario:** Edición de horarios existentes<br>**Given** el gestor abre "Editar horarios" y las entradas existentes se cargan<br>**When** modifica StartTime, EndTime, Enabled o añade/elimina días<br>**And** pulsa "Guardar"<br>**Then** el sistema persiste los cambios en la BD<br>**And** muestra el mensaje "Horarios actualizados" | E02 |
| US09 | Explorar talleres filtrados | Como conductor, quiero explorar una lista de talleres filtrada por región → provincia → distrito → ciudad (o por mi ubicación actual), para encontrar rápidamente uno cercano. | **Scenario:** Filtrar por ciudad y listar talleres<br>**Given** el conductor está en la pantalla "Explorar talleres"<br>**When** no ha seleccionado aún la cascada completa Región → Provincia → Distrito → Ciudad<br>**Then** el sistema muestra "Selecciona tu ciudad para ver talleres disponibles"<br><br>**Scenario:** Mostrar resultados de la ciudad seleccionada<br>**Given** el conductor selecciona una ciudad válida en el filtro<br>**When** la API devuelve talleres de esa ciudad<br>**Then** el sistema muestra cards con photo miniatura, name, short description, address y botón "Ver más"<br><br>**Scenario:** Sin talleres en la ciudad<br>**Given** el conductor selecciona una ciudad sin talleres<br>**Then** el sistema muestra "No se encontraron talleres en esta ubicación" | E03 |
| US10 | Ver detalle de taller | Como conductor, quiero ver la ficha detallada de un taller seleccionado, para decidir si se ajusta a mis necesidades. | **Scenario:** Visualizar detalle y contactar<br>**Given** el conductor está en la lista de talleres filtrados<br>**When** pulsa el botón "Ver más" de un taller<br>**Then** se abre la página de detalle del taller con photo grande, name, description extendida, address, email, phone<br>**And** se listan los horarios (DayOfWeek, Start–End, Enabled)<br>**And** hay un botón "Contactar" que abre https://wa.me/&lt;phone&gt; en nueva pestaña<br>**And** un enlace "← Volver" regresa al listado conservando el filtro<br>**And** si algún campo está vacío se muestra "Información no disponible" | E03 |
| US11 | Registrar vehículo | Como gestor de taller, quiero registrar un vehículo de cliente (carBrand, carModel, fuelType, licensePlate, year), para poder asociarlo luego a órdenes de reparación. | **Scenario:** Registro exitoso de vehículo<br>**Given** el gestor está en el formulario "Registrar vehículo"<br>**When** completa carBrand, carModel, fuelType, licensePlate y year (1980 – año actual)<br>**And** la placa no existe en otro vehículo del taller<br>**Then** el sistema guarda el vehículo en la BD<br>**And** muestra "Vehículo registrado" | E04 |
| US12 | Listar vehículos del taller | Como gestor de taller, quiero listar mis vehículos registrados, para ver rápidamente los que ya están cargados o crear uno nuevo. | **Scenario:** Sin vehículos registrados<br>**Given** el gestor accede a "Mis vehículos"<br>**And** no hay vehículos en la BD<br>**Then** el sistema muestra "Aún no tienes vehículos registrados" y un botón "Registrar vehículo"<br><br>**Scenario:** Con vehículos registrados<br>**Given** existen vehículos asociados al taller<br>**Then** el sistema muestra cards con carBrand, carModel, licensePlate, year y color (si existe), cada una con botón "Crear reparación" | E04 |
| US13 | Crear orden de reparación | Como gestor de taller, quiero crear una orden de reparación a partir de un vehículo, para llevar el control del trabajo. | **Scenario:** Creación de reparación cuando no existe una abierta<br>**Given** el gestor visualiza un vehículo sin reparaciones abiertas<br>**When** pulsa "Crear reparación"<br>**Then** el sistema genera *repairCode* = *licensePlate-NN* (correlativo por vehículo)<br>**And** crea la reparación con estado inicial "Por revisar" y *updatedAt* actual<br><br>**Scenario:** Reparación abierta impide una nueva<br>**Given** el vehículo ya tiene una reparación no entregada<br>**Then** el botón "Crear reparación" aparece deshabilitado<br>**And** muestra el tooltip "Ya existe una reparación abierta" | E05 |
| US14 | Cambiar estado de reparación | Como gestor de taller, quiero cambiar el estado de una reparación entre Por revisar → En revisión → Revisado → Entregado, para reflejar su avance. | **Scenario:** Avanzar al siguiente estado<br>**Given** el gestor está en la orden con estado actual *S* (donde *S* ≠ "Entregado")<br>**When** selecciona avanzar al siguiente estado permitido<br>**Then** el sistema actualiza el estado<br>**And** registra la fecha y hora en *updatedAt*<br><br>**Scenario:** Cerrar reparación al marcar "Entregado"<br>**Given** la reparación está en estado "Revisado"<br>**When** el gestor marca "Entregado"<br>**Then** la reparación queda cerrada<br>**And** el botón "Crear reparación" se habilita de nuevo para ese vehículo | E05 |
| US15 | Filtrar reparaciones por estado | Como gestor de taller, quiero filtrar mis reparaciones por estado, para ver rápidamente qué autos requieren atención. | **Scenario:** Filtrar reparaciones exitosamente<br>**Given** el gestor está en la vista de reparaciones y elige un estado (Por revisar, En revisión, Revisado, Entregado, Todas)<br>**When** selecciona el estado<br>**Then** la lista se actualiza en ≤ 1 s mostrando solo las reparaciones que coinciden<br><br>**Scenario:** Sin reparaciones para el estado elegido<br>**Given** el gestor selecciona un estado sin coincidencias<br>**Then** el sistema muestra "Sin resultados" | E05 |
| US16 | Tracking de reparación (conductor) | Como conductor, quiero ingresar el código de seguimiento (repairCode) que me dio el taller, para conocer el estado de la reparación de mi vehículo. | **Scenario:** Código válido<br>**Given** el conductor está en la pantalla "Tracking"<br>**When** ingresa un *repairCode* existente en formato *LICENSE-NN*<br>**Then** el sistema redirige a la vista Detalle de reparación<br><br>**Scenario:** Código inexistente<br>**Given** el conductor está en la pantalla "Tracking"<br>**When** ingresa un *repairCode* que no existe<br>**Then** el sistema muestra "Código no encontrado" | E06 |
| US17 | Ver detalle de reparación | Como conductor, quiero ver el estado actual y los detalles de mi reparación, para estar informado sin llamar ni visitar el taller. | **Scenario:** Visualizar detalles de la reparación<br>**Given** el conductor accede a la página de detalle usando un *repairCode* válido<br>**Then** el sistema muestra:<br> • Estado (Por revisar / En revisión / Revisado / Entregado)<br> • *UpdatedAt* (fecha y hora de la última actualización)<br> • Datos del vehículo: *carBrand, carModel, fuelType, licensePlate, year*<br> • Datos del taller: *name, dirección completa, ciudad/distrito*<br>**And** presenta un botón "Contactar taller" que abre `https://wa.me/<phone>` en nueva pestaña<br>**And** si el estado es "Entregado", se destaca con un icono/etiqueta verde y el botón de contacto permanece disponible | E06 |
| TS01 | Implementar Sistema de Autenticación Basado en JWT | Como desarrollador, quiero implementar un sistema de autenticación robusto basado en JWT, para asegurar las sesiones de los usuarios y proteger la comunicación entre el frontend y el backend, garantizando que solo usuarios autorizados accedan a recursos protegidos. | **Scenario:** Generación exitosa de JWT al iniciar sesión<br>**Given** un usuario ha proporcionado credenciales válidas<br>**When** el usuario intenta iniciar sesión<br>**Then** el sistema debe generar un JWT válido<br>**And** el sistema debe devolver el JWT al cliente<br><br>**Scenario:** Validación de JWT en solicitudes a endpoints protegidos<br>**Given** un usuario tiene un JWT válido<br>**When** el usuario realiza una solicitud a un endpoint protegido incluyendo el JWT<br>**Then** el sistema debe validar el JWT correctamente<br>**And** debe permitir el acceso al recurso<br><br>**Scenario:** Manejo de JWT inválido o ausente<br>**Given** una solicitud a un endpoint protegido<br>**When** el JWT es inválido o está ausente<br>**Then** el sistema debe devolver un código de estado 401 (Unauthorized)<br><br>**Scenario:** Manejo de expiración de JWT<br>**Given** un usuario con un JWT que ha expirado<br>**When** el usuario realiza una solicitud a un endpoint protegido<br>**Then** el sistema debe requerir una nueva autenticación o un token de refresco (si aplica)<br><br>**Scenario:** Almacenamiento seguro de JWT en el cliente<br>**Given** un JWT válido<br>**When** el JWT se envía al cliente<br>**Then** debe almacenarse siguiendo las mejores prácticas de seguridad (e.g., consideraciones de localStorage, sessionStorage, o HttpOnly cookies) |  |
| TS02 | Implementar Hashing de Contraseñas con Bcrypt | Como desarrollador, quiero implementar el algoritmo de hashing Bcrypt para las contraseñas de los usuarios, para garantizar su seguridad en la base de datos y proteger contra ataques de fuerza bruta o exposición de datos en texto plano. | **Scenario:** Hashing de contraseñas durante el registro<br>**Given** un nuevo usuario proporciona una contraseña<br>**When** la contraseña se guarda en la base de datos<br>**Then** la contraseña debe ser hasheada usando Bcrypt con un "salt" único y aleatorio<br><br>**Scenario:** Verificación de contraseñas durante el inicio de sesión<br>**Given** un usuario proporciona una contraseña para iniciar sesión<br>**When** el sistema verifica la contraseña<br>**Then** el sistema debe usar la función de verificación de Bcrypt para comparar la contraseña con el hash almacenado<br>**And** el inicio de sesión debe ser exitoso si la comparación coincide, o fallar si no | TS-002 |
| TS03 | Configurar Gestión Segura de Variables de Entorno | Como desarrollador, quiero configurar un sistema seguro para la gestión de variables de entorno, para evitar la exposición de credenciales y claves sensibles en el código fuente y permitir una configuración flexible entre distintos entornos (desarrollo, staging, producción). | **Scenario:** Carga de credenciales en producción<br>**Given** la aplicación se despliega en un entorno de producción<br>**When** la aplicación se inicia<br>**Then** las credenciales de la base de datos, claves de JWT y otras claves de API deben ser cargadas desde variables de entorno del sistema operativo o un gestor de secretos<br><br>**Scenario:** Uso de .env en desarrollo<br>**Given** un desarrollador trabaja en el entorno local<br>**When** la aplicación se ejecuta localmente<br>**Then** debe cargar las variables de entorno desde un archivo .env que no esté versionado en Git<br><br>**Scenario:** Ausencia de secretos hardcodeados<br>**Given** el código fuente de la aplicación<br>**When** se revisa el código<br>**Then** ninguna credencial sensible o secreto debe estar hardcodeado directamente en el código | |
| TS04 | Diseñar y Configurar la Base de Datos Relacional (PostgreSQL) | Como desarrollador, quiero diseñar el esquema de la base de datos y configurarla usando MySql, para almacenar de manera eficiente, segura y escalable toda la información del negocio, como usuarios, talleres, citas y reparaciones. | **Scenario:** Diseño y creación del esquema de la base de datos<br>**Given** el inicio del desarrollo del proyecto<br>**When** se define la estructura de datos<br>**Then** el esquema de la base de datos debe estar diseñado con tablas claras para Usuarios, Talleres, Citas, Mantenimientos, etc.<br><br>**Scenario:** Establecimiento de relaciones entre tablas<br>**Given** las tablas de la base de datos<br>**When** se definen las relaciones entre ellas<br>**Then** deben establecerse correctamente las claves primarias y foráneas para asegurar la integridad referencial<br><br>**Scenario:** Optimización del rendimiento de consultas<br>**Given** la identificación de consultas que serán frecuentes (e.g., búsqueda de talleres, listar citas)<br>**When** se optimiza el esquema<br>**Then** se deben crear índices apropiados en los campos clave para mejorar el rendimiento de estas consultas<br><br>**Scenario:** Conexión segura a la base de datos<br>**Given** la aplicación intenta conectarse a la base de datos<br>**When** la conexión se establece<br>**Then** debe ser segura (e.g., uso de credenciales separadas, conexión cifrada si el entorno lo requiere) y configurable |  |
| TS05 | Desarrollar API RESTful para la Gestión de Usuarios | Como desarrollador, quiero desarrollar los endpoints del API RESTful para la gestión de usuarios, para permitir a los usuarios registrarse, iniciar sesión, y gestionar su información de perfil de forma programática y segura, sirviendo como la interfaz principal para estas funcionalidades. | **Scenario:** Registro de nuevos usuarios<br>**Given** se envía una solicitud POST a /api/register con los datos de un nuevo usuario<br>**When** los datos son válidos<br>**Then** el sistema debe crear el usuario y devolver un código de estado 201 Created<br><br>**Scenario:** Inicio de sesión de usuarios existentes<br>**Given** se envía una solicitud POST a /api/login con credenciales válidas<br>**When** las credenciales son correctas<br>**Then** el sistema debe devolver un JWT y un código de estado 200 OK<br><br>**Scenario:** Obtención del perfil de usuario<br>**Given** un usuario autenticado<br>**When** se envía una solicitud GET a /api/users/{id}<br>**Then** el sistema debe devolver los detalles del perfil del usuario correspondiente con un código 200 OK<br><br>**Scenario:** Actualización del perfil de usuario<br>**Given** un usuario autenticado con permisos para modificar su perfil<br>**When** se envía una solicitud PUT a /api/users/{id} con datos actualizados<br>**Then** el sistema debe actualizar el perfil del usuario y devolver un 200 OK<br><br>**Scenario:** Eliminación del perfil de usuario<br>**Given** un usuario autenticado con permisos para eliminar su perfil<br>**When** se envía una solicitud DELETE a /api/users/{id}<br>**Then** el sistema debe eliminar el perfil del usuario y devolver un 204 No Content<br><br>**Scenario:** Formato de comunicación API<br>**Given** cualquier solicitud o respuesta a estos endpoints<br>**Then** deben manejar el formato JSON<br><br>**Scenario:** Uso de códigos de estado HTTP apropiados<br>**Given** cualquier operación en estos endpoints<br>**Then** el sistema debe devolver los códigos de estado HTTP estándar (e.g., 400 Bad Request, 401 Unauthorized, 404 Not Found, 500 Internal Server Error) según el resultado | TS07 |
| TS06 | Desarrollar API RESTful para la Gestión de Talleres y Citas | Como desarrollador, quiero implementar los endpoints del API RESTful para la gestión de talleres y citas, para permitir a los usuarios buscar talleres, solicitar citas y gestionar sus citas existentes de manera programática. | **Scenario:** Búsqueda de talleres<br>**Given** se envía una solicitud GET a /api/workshops<br>**When** se incluyen parámetros de filtro (e.g., ubicación, especialidad)<br>**Then** el sistema debe devolver una lista de talleres que coincidan con los criterios<br><br>**Scenario:** Obtención de detalles de un taller específico<br>**Given** se envía una solicitud GET a /api/workshops/{id}<br>**When** el id del taller es válido<br>**Then** el sistema debe devolver los detalles completos del taller<br><br>**Scenario:** Solicitud de una nueva cita<br>**Given** un usuario autenticado<br>**When** se envía una solicitud POST a /api/appointments con los detalles de la cita (taller, fecha, hora, vehículo, etc.)<br>**Then** el sistema debe crear la nueva cita y devolver un 201 Created<br><br>**Scenario:** Listado de citas de un usuario<br>**Given** un usuario autenticado<br>**When** se envía una solicitud GET a /api/appointments/user/{id}<br>**Then** el sistema debe devolver una lista de todas las citas asociadas a ese usuario<br><br>**Scenario:** Actualización o cancelación de una cita<br>**Given** un usuario autenticado con permisos sobre una cita existente<br>**When** se envía una solicitud PUT o DELETE a /api/appointments/{id} para actualizar el estado o cancelar la cita<br>**Then** el sistema debe procesar la solicitud (actualizar/cancelar) y devolver el código de estado HTTP apropiado (e.g., 200 OK, 204 No Content) |  |
| TS07 | Implementar Sistema de Notificaciones en la Aplicación | Como desarrollador, quiero implementar un sistema de notificaciones dentro de la aplicación, para que los usuarios reciban alertas sobre eventos importantes (e.g., cambio de estado de reparación, nueva cita agendada, recordatorios), mejorando la experiencia del usuario y la comunicación interna. | **Scenario:** Generación de notificación al cambiar el estado de reparación<br>**Given** el estado de una orden de reparación cambia (e.g., "Por revisar" a "En revisión")<br>**When** el cambio de estado se registra en el sistema<br>**Then** el sistema debe generar una notificación relevante para el cliente y/o el taller<br><br>**Scenario:** Visualización de notificaciones<br>**Given** un usuario ha recibido nuevas notificaciones<br>**When** el usuario accede a la sección de notificaciones de la aplicación<br>**Then** debe poder ver una lista de sus notificaciones, ordenadas cronológicamente<br><br>**Scenario:** Marcado de notificaciones como leídas<br>**Given** un usuario ha visto una notificación<br>**When** el usuario interactúa con ella (e.g., clic, deslizar)<br>**Then** la notificación debe marcarse como leída en el sistema<br>**And** el contador de notificaciones no leídas debe actualizarse<br><br>**Scenario:** Persistencia de notificaciones<br>**Given** un usuario recibe notificaciones<br>**When** el usuario cierra sesión y vuelve a iniciarla<br>**Then** sus notificaciones (leídas y no leídas) deben persistir |  |
| TS8 | Implementar Paginación y Filtrado Avanzado en Listados | Como desarrollador, quiero implementar funcionalidad de paginación y filtrado avanzado en los listados (e.g., talleres, citas, reparaciones), para mejorar el rendimiento de la aplicación y la experiencia del usuario al manejar grandes volúmenes de datos, permitiendo búsquedas más específicas. | **Scenario:** Paginación de resultados<br>**Given** un listado de elementos (e.g., 100 talleres)<br>**When** se solicita la página 1 con 10 elementos por página<br>**Then** la API debe devolver solo los primeros 10 elementos<br>**And** debe incluir metadatos de paginación (número total de elementos, página actual, total de páginas)<br><br>**Scenario:** Filtrado por múltiples criterios<br>**Given** un listado de elementos<br>**When** se envía una solicitud con múltiples parámetros de filtro (e.g., workshops?region=Lima&specialty=Mecanica)<br>**Then** la API debe devolver solo los elementos que cumplan todos los criterios especificados<br><br>**Scenario:** Ordenamiento de resultados<br>**Given** un listado de elementos<br>**When** se solicita el ordenamiento por un campo específico (e.g., workshops?sortBy=rating&order=desc)<br>**Then** la API debe devolver los elementos ordenados según el criterio<br><br>**Scenario:** Manejo de parámetros inválidos<br>**Given** una solicitud con parámetros de paginación, filtro u ordenamiento inválidos<br>**When** la API recibe la solicitud<br>**Then** debe devolver un error 400 Bad Request con un mensaje descriptivo |  |
| TS09 | Optimizar Consultas a la Base de Datos para Rendimiento | Como desarrollador, quiero optimizar las consultas a la base de datos, especialmente las complejas o las que se ejecutan frecuentemente, para mejorar el tiempo de respuesta de la aplicación y asegurar una experiencia de usuario fluida, incluso bajo carga. | **Scenario:** Identificación de consultas lentas<br>**Given** la aplicación está bajo carga o se realizan operaciones comunes<br>**When** se monitorea el rendimiento de la base de datos<br>**Then** se deben identificar las consultas que tienen un tiempo de ejecución superior a un umbral definido<br><br>**Scenario:** Optimización de consultas identificadas<br>**Given** una consulta lenta identificada<br>**When** se refactoriza la consulta (e.g., ajustar índices, reescribir JOINs, usar EXPLAIN ANALYZE)<br>**Then** su tiempo de ejecución debe reducirse a un nivel aceptable<br><br>**Scenario:** Implementación de caché para datos frecuentemente accedidos<br>**Given** datos que se consultan con alta frecuencia y cambian poco (e.g., lista de especialidades)<br>**When** se accede a estos datos<br>**Then** el sistema debe utilizar un mecanismo de caché para reducir la carga de la base de datos y acelerar la respuesta<br><br>**Scenario:** Uso eficiente de ORM/SQL<br>**Given** la interacción con la base de datos a través de un ORM (si aplica)<br>**When** se realizan operaciones de lectura o escritura<br>**Then** se deben utilizar las funcionalidades del ORM de manera eficiente (e.g., eager loading, selección de campos específicos) o escribir SQL nativo optimizado |  |
| TS10 | Implementar Persistencia para Agregados Car y RepairOrder | Como desarrollador, quiero implementar la lógica de persistencia para los agregados Car y RepairOrder, para asegurar el almacenamiento y recuperación de la información de vehículos y órdenes de reparación. | **Scenario:** Implementación de CarRepository<br>**Given** el módulo de gestión de reparaciones<br>**When** se implementa CarRepository<br>**Then** debe asegurar su correcto funcionamiento con la base de datos (JPA)<br><br>**Scenario:** Definición de RepairOrderRepository<br>**Given** la necesidad de persistir órdenes de reparación<br>**When** se define e implementa RepairOrderRepository<br>**Then** debe incluir todas las operaciones necesarias para el manejo de órdenes<br><br>**Scenario:** Operaciones CRUD completas<br>**Given** los repositorios Car y RepairOrder<br>**When** se ejecutan las operaciones de guardar, actualizar, eliminar y buscar (findById, findAll)<br>**Then** todas las operaciones deben funcionar correctamente para Car y RepairOrder |  |
| TS11 | Optimizar Rendimiento de Consultas de Vehículos y Reparaciones | Como desarrollador, quiero optimizar las consultas existentes (GetAllCarsQuery, GetCarByPlaceQuery, GetAllRepairQuery, GetRepairByIdRepairQuery, GetRepairByStatusQuery), para mejorar el tiempo de respuesta y la eficiencia de la aplicación al recuperar datos. | **Scenario:** Revisión y optimización de consultas SQL<br>**Given** las consultas existentes en CarQueryServiceImpl<br>**When** se revisan y optimizan las consultas SQL (o equivalentes ORM) generadas<br>**Then** deben mostrar mejoras medibles en el rendimiento<br><br>**Scenario:** Evaluación de índices de base de datos<br>**Given** las columnas utilizadas en los criterios de búsqueda<br>**When** se evalúa la necesidad de índices en la base de datos<br>**Then** se deben crear los índices necesarios para optimizar las consultas<br><br>**Scenario:** Cumplimiento de umbrales de rendimiento<br>**Given** las consultas optimizadas<br>**When** se ejecutan bajo condiciones de carga<br>**Then** deben cumplir con umbrales de rendimiento definidos (e.g., tiempo de respuesta < X ms para Y registros) |  |
| TS12 | Implementar Validaciones de Negocio para Comandos de Reparaciones | Como desarrollador, quiero añadir validaciones de negocio a los comandos (AddRepairCommand, CreateCarCommand, CreateRepairCommand, DeleteRepairCommand, UpdateStatusCommand), para prevenir datos inconsistentes y asegurar que las reglas de negocio se cumplan antes de ejecutar las operaciones. | **Scenario:** Validaciones específicas por comando<br>**Given** cada comando de reparación<br>**When** se ejecuta el comando<br>**Then** debe tener validaciones específicas de negocio implementadas<br><br>**Scenario:** Ejecución de validaciones antes de la lógica principal<br>**Given** un comando con validaciones implementadas<br>**When** se procesa el comando<br>**Then** las validaciones deben ejecutarse antes de la lógica principal del servicio<br><br>**Scenario:** Manejo de errores de validación<br>**Given** un comando que falla las validaciones<br>**When** las validaciones fallan<br>**Then** se deben lanzar excepciones claras y manejables |  |
| TS13 | Implementar Persistencia para Agregados Workshop | Como desarrollador, quiero implementar la lógica de persistencia para el agregado Workshop y sus entidades relacionadas (District, Province, Region, ScheduleEntry, Service), para asegurar el almacenamiento y recuperación de la información de los talleres y su estructura geográfica y de servicios. | **Scenario:** Funcionamiento de WorkshopRepository<br>**Given** el módulo de gestión de talleres<br>**When** se utiliza WorkshopRepository<br>**Then** debe asegurar su correcto funcionamiento con la base de datos (JPA)<br><br>**Scenario:** Operaciones CRUD para Workshop y entidades relacionadas<br>**Given** Workshop y sus entidades relacionadas<br>**When** se ejecutan las operaciones CRUD<br>**Then** todas las operaciones deben funcionar correctamente para Workshop y sus entidades<br><br>**Scenario:** Manejo de relaciones entre entidades<br>**Given** las entidades Workshop, District, Province, Region, ScheduleEntry y Service<br>**When** se persisten en la base de datos<br>**Then** se deben manejar correctamente las relaciones entre estas entidades |  |
| TS14 | Optimizar Rendimiento de Consultas de Talleres y Datos Geográficos | Como desarrollador, quiero optimizar las consultas existentes (GetAllRegions, GetDistrictById, GetWorkshopsByDistrictId, etc.), para mejorar el tiempo de respuesta y la eficiencia al recuperar datos de talleres y su ubicación. | **Scenario:** Optimización de consultas SQL<br>**Given** las consultas existentes en los QueryServiceImpl correspondientes<br>**When** se revisan y optimizan las consultas SQL generadas<br>**Then** deben mostrar mejoras medibles en el rendimiento<br><br>**Scenario:** Evaluación de índices para datos geográficos<br>**Given** las columnas utilizadas en los criterios de búsqueda geográfica<br>**When** se evalúa la necesidad de índices en la base de datos<br>**Then** se deben crear los índices necesarios para optimizar las consultas<br><br>**Scenario:** Cumplimiento de umbrales de rendimiento<br>**Given** las consultas optimizadas de talleres<br>**When** se ejecutan bajo condiciones de carga<br>**Then** deben cumplir con umbrales de rendimiento definidos |  |
| TS15 | Implementar Validaciones de Negocio para Comandos de Talleres y Datos Geográficos | Como desarrollador, quiero añadir validaciones de negocio a los comandos (CreateDistrictCommand, CreateProvinceCommand, CreateRegionCommand, CreateWorkshopCommand, SeedServicesCommand), para prevenir datos inconsistentes y asegurar que las reglas de negocio se cumplan. | **Scenario:** Validaciones específicas por comando geográfico<br>**Given** cada comando de taller y datos geográficos<br>**When** se ejecuta el comando<br>**Then** debe tener validaciones específicas de negocio implementadas<br><br>**Scenario:** Ejecución previa de validaciones<br>**Given** un comando con validaciones implementadas<br>**When** se procesa el comando<br>**Then** las validaciones deben ejecutarse antes de la lógica principal del servicio<br><br>**Scenario:** Manejo claro de errores de validación<br>**Given** un comando que falla las validaciones<br>**When** las validaciones fallan<br>**Then** se deben lanzar excepciones claras y manejables |  |
| TS16 | Mejorar Manejo de Excepciones y Mapeo a Respuestas REST | Como desarrollador, quiero consolidar y mejorar el manejo de excepciones a nivel global de la API REST, para proporcionar respuestas de error consistentes y amigables al cliente, independientemente del módulo que origine el error. | **Scenario:** Manejo centralizado de excepciones<br>**Given** la API REST global<br>**When** se implementa el manejo de excepciones<br>**Then** se debe utilizar un ControllerAdvice o similar para centralizar el manejo de excepciones<br><br>**Scenario:** Mapeo apropiado de excepciones<br>**Given** excepciones de dominio y de validación<br>**When** se procesan las excepciones<br>**Then** se deben mapear a códigos de estado HTTP apropiados (e.g., 400, 404, 409)<br><br>**Scenario:** Respuestas de error descriptivas<br>**Given** una excepción procesada<br>**When** se genera la respuesta de error<br>**Then** debe incluir mensajes descriptivos y, opcionalmente, códigos de error específicos | |
| TS17 | Implementar Patrón de Diseño para AuditableAbstractAggregateRoot y AuditableModel | Como desarrollador, quiero asegurar que AuditableAbstractAggregateRoot y AuditableModel manejen correctamente la información de auditoría (e.g., createdAt, updatedAt), para proporcionar trazabilidad y auditoría de los cambios en las entidades del dominio. | **Scenario:** Actualización automática de campos de auditoría<br>**Given** las entidades que extienden AuditableAbstractAggregateRoot y AuditableModel<br>**When** se crean o modifican entidades<br>**Then** los campos de auditoría se deben actualizar automáticamente en la creación y modificación<br><br>**Scenario:** Uso de mecanismo JPA para auditoría<br>**Given** la implementación de auditoría<br>**When** se configura el sistema<br>**Then** se debe utilizar un mecanismo de JPA (e.g., @CreatedDate, @LastModifiedDate, AuditingEntityListener) para automatizar la auditoría<br><br>**Scenario:** Captura de información del usuario<br>**Given** una acción realizada por un usuario<br>**When** se registra la auditoría<br>**Then** se debe capturar la información del usuario que realiza la acción (si aplica) | |
| TS18 | Refactorizar y Asegurar Consistencia de Objetos de Valor del Dominio | Como desarrollador, quiero asegurar que los valueobjects de ambos módulos (repairManagement y workshopManagement) sean inmutables y estén correctamente validados, para garantizar la integridad y consistencia de los datos en todo el sistema. | **Scenario:** Inmutabilidad de valueobjects<br>**Given** todos los valueobjects (e.g., Plate, RepairId, WorkshopEmail, WorkshopLocation)<br>**When** se utilizan en el sistema<br>**Then** deben ser inmutables<br><br>**Scenario:** Validaciones en constructores<br>**Given** los valueobjects del dominio<br>**When** se crean instancias<br>**Then** se deben implementar validaciones en sus constructores o métodos de creación estáticos<br><br>**Scenario:** Implementación correcta de equals() y hashCode()<br>**Given** los valueobjects<br>**When** se comparan entre sí<br>**Then** se debe utilizar correctamente el patrón equals() y hashCode() para la comparación |  |
| TS19 | Configurar y Optimizar Sistema de Logs del Proyecto | Como desarrollador, quiero implementar una configuración de logging robusta y eficiente, para facilitar la depuración, el monitoreo y el análisis de comportamiento de la aplicación en producción. | **Scenario:** Configuración de framework de logging<br>**Given** el proyecto en desarrollo<br>**When** se configura el logging<br>**Then** se debe configurar un framework de logging (e.g., Logback) con diferentes niveles (INFO, DEBUG, WARN, ERROR)<br><br>**Scenario:** Formato legible de logs<br>**Given** el sistema de logging configurado<br>**When** se generan logs<br>**Then** los logs se deben guardar en un formato legible y útil<br><br>**Scenario:** Registro de eventos clave<br>**Given** los módulos principales de la aplicación<br>**When** se ejecutan operaciones importantes<br>**Then** se deben registrar eventos clave (inicio/fin de operaciones, errores, advertencias)<br><br>**Scenario:** Evitar logging excesivo<br>**Given** la configuración de logging<br>**When** se ejecuta la aplicación<br>**Then** se debe evitar el "logging excesivo" que pueda afectar el rendimiento |  |
















## 3.3. Impact Mapping

<img src="./src/Impact map 1.png " alt="Impact map 1" style="display: block; margin: 50px auto 0 auto;"/> 


## 3.4. Product Backlog
This section lists the prioritized product backlog items, including features, enhancements, and technical tasks.

## Product Backlog

| #Orden | User Story ID | Título | Descripción (resumen) | Story Points |
|--------|---------------|--------|-----------------------|--------------|
| 1 | **US01** | Registrar cuenta de gestor | Alta de usuario gestor (email, username únicos, pwd ≥ 6, bcrypt) | **5** |
| 2 | **US02** | Iniciar sesión | Autenticación (JWT) y ruteo a dashboard / onboarding | **3** |
| 3 | **US03** | Actualizar perfil personal | Cambiar firstname, lastname, username | **2** |
| 4 | **US04** | Cerrar sesión | Invalidar JWT y redirigir al login | **1** |
| 5 | **US05** | Registrar taller | Formulario completo + cascada Región → Ciudad + validaciones | **8** |
| 6 | **US06** | Editar taller | Actualizar datos del taller con autocompletado | **5** |
| 7 | **US07** | Configurar horarios | Crear calendario regular de atención con validaciones | **5** |
| 8 | **US08** | Actualizar horarios | Modificar o eliminar entradas de horario existentes | **3** |
| 9 | **US09** | Explorar talleres filtrados | Búsqueda por Región → Ciudad y cards de resultado | **5** |
| 10 | **US10** | Ver detalle de taller | Ficha completa + horarios + botón WhatsApp | **3** |
| 11 | **US11** | Registrar vehículo | Alta de vehículo (placa única, año válido) | **5** |
| 12 | **US12** | Listar vehículos | Cards de vehículos + botón “Crear reparación” | **3** |
| 13 | **US13** | Crear orden de reparación | Generar `repairCode` y estado inicial “Por revisar” | **8** |
| 14 | **US14** | Cambiar estado de reparación | Flujo Por revisar→En revisión→Revisado→Entregado con `updatedAt` | **5** |
| 15 | **US15** | Filtrar reparaciones | Lista filtrable por estado, respuesta ≤ 1 s | **3** |
| 16 | **US16** | Tracking de reparación (conductor) | Campo `repairCode`, validación y redirección | **3** |
| 17 | **US17** | Ver detalle de reparación | Estado + vehículo + taller + botón WhatsApp | **3** |


